/api/v1/payments:
  get:
    tags: [Payments]
    summary: List payments
    description: List payments. CLIENT sees only their payments.
    operationId: getPayments
    x-roles: [CLIENT, ADMIN, GM, TM]
    parameters:
      - name: page
        in: query
        schema:
          type: integer
          default: 1
      - name: limit
        in: query
        schema:
          type: integer
          default: 20
    responses:
      "200":
        description: List of payments
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
                  items:
                    $ref: '#/components/schemas/PaymentResponse'
            example:
              success: true
              data:
                - id: "01933c5e-7f2a-7a00-8000-1a2b3c4d5e6f"
                  invoice_number: "INV-2026-001234"
                  amount: 1500.00
                  payment_status: "UNPAID"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/payments/summary:
  get:
    tags: [Payments]
    summary: Financial summary
    description: Get financial summary. CLIENT, ADMIN, GM only.
    operationId: getFinancialSummary
    x-roles: [CLIENT, ADMIN, GM]
    responses:
      "200":
        description: Financial summary
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/FinancialSummaryResponse'

/api/v1/payments/invoice:
  post:
    tags: [Payments]
    summary: Create invoice
    description: Create a new invoice for a job. ADMIN, GM, TM only.
    operationId: createInvoice
    x-roles: [ADMIN, GM, TM]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateInvoiceRequest'
          example:
            job_id: "01933c5e-7f2a-7a00-8000-1a2b3c4d5e6f"
            amount: 1500.00
            currency: "USD"
    responses:
      "201":
        description: Invoice created
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/PaymentResponse'
      "400":
        description: Validation error
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/payments/{id}:
  get:
    tags: [Payments]
    summary: Get payment by ID
    description: Get payment details by ID.
    operationId: getPaymentById
    x-roles: [CLIENT, ADMIN, GM, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Payment details
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/PaymentResponse'
      "404":
        description: Payment not found
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/payments/{id}/pay:
  put:
    tags: [Payments]
    summary: Mark invoice as paid
    description: Mark an invoice as paid. ADMIN, GM, TM only.
    operationId: markPaymentPaid
    x-roles: [ADMIN, GM, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              payment_date:
                type: string
                format: date
              receipt_url:
                type: string
          example:
            payment_date: "2026-02-13"
            receipt_url: "https://storage.example.com/receipts/receipt-123.pdf"
    responses:
      "200":
        description: Payment marked as paid
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/PaymentResponse'

/api/v1/payments/{id}/refund:
  post:
    tags: [Payments]
    summary: Process refund
    description: Process a refund for a payment. ADMIN, GM only.
    operationId: refundPayment
    x-roles: [ADMIN, GM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              amount:
                type: number
              reason:
                type: string
          example:
            amount: 500.00
            reason: "Duplicate payment. Refund requested by client."
    responses:
      "200":
        description: Refund processed
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object

/api/v1/payments/{id}/partial:
  post:
    tags: [Payments]
    summary: Record partial payment
    description: Record a partial payment against an invoice. ADMIN, GM, TM only.
    operationId: recordPartialPayment
    x-roles: [ADMIN, GM, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PartialPaymentRequest'
          example:
            amount: 500.00
            remarks: "First instalment"
    responses:
      "200":
        description: Partial payment recorded
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/PaymentResponse'
