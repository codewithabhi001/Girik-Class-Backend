openapi: 3.0.0
info:
  title: Maritime Vessel Certification System API
  version: 1.0.0
  description: |
    API documentation for the Maritime Vessel Certification and Survey Management System.
    
    ### Domain Driven Design
    APIs are grouped by domain (Jobs, Vessels, Payments, etc).
    
    ### Authentication
    All endpoints (except Auth) require Bearer JWT authentication.
    
    ### Roles & Permissions
    RBAC is enforced via middleware using `x-roles` extension in documentation.
    Allowed Roles: ADMIN, GM, TM, TO, TA, SURVEYOR, CLIENT.

servers:
  - url: http://localhost:3000/api/v1
    description: Local Development Server

tags:
  - name: Auth
    description: Authentication & Authorization
  - name: Users
    description: User Management
  - name: Clients
    description: Client & Company Management
  - name: Vessels
    description: Vessel Registry & Management
  - name: Jobs
    description: Survey & Certification Jobs
  - name: Surveys
    description: Survey Reports & Inspections
  - name: Certificates
    description: Certificate Issuance & Validation
  - name: Payments
    description: Invoicing & Payment Processing
  - name: Notifications
    description: System Notifications & Alerts
  - name: Providers
    description: Service Provider Management
  - name: System
    description: System Configuration & Logs
  - name: Compliance
    description: Regulatory Compliance & Rules
  - name: Documents
    description: Document Storage & Management
  - name: Flags
    description: Flag Management
  - name: Incidents
    description: Incident Reporting & Resolution
  - name: Non-Conformities
    description: Non-Conformity Management
  - name: Activity Requests
    description: Client Activity Request Management
  - name: Approvals
    description: Multi-level Approval Workflow
  - name: Change Requests
    description: System Entity Change Requests
  - name: Checklists
    description: Job Inspection Checklists
  - name: Feedback
    description: Customer Feedback & Ratings
  - name: Support
    description: Customer Support & Ticketing
  - name: Search
    description: Global Search
  - name: Mobile
    description: Mobile App Synchronization & Offline Data
  - name: TOCA
    description: Transfer of Class Agreement
  - name: Reports
    description: Management Reports & Analytics
  - name: Certificate Templates
    description: Management of Certificate Templates
  - name: Surveyors
    description: Surveyor Management & Applications

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # --- Common Types ---
    UUID:
      type: string
      format: uuid
      example: "550e8400-e29b-41d4-a716-446655440000"
    
    Date:
      type: string
      format: date-time
      example: "2023-10-27T10:00:00Z"

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Internal Server Error"
        error:
          type: object

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation successful"
        data:
          type: object

    PaginationResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        meta:
          type: object
          properties:
            page:
              type: integer
              example: 1
            limit:
              type: integer
              example: 10
            total:
              type: integer
              example: 50
            totalPages:
              type: integer
              example: 5
        data:
          type: array
          items:
            type: object
          
    # --- Domain Entities ---
    User:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        role:
          type: string
          enum: [ADMIN, GM, TM, TO, TA, SURVEYOR, CLIENT]
        isActive:
          type: boolean
        createdAt:
          $ref: '#/components/schemas/Date'

    Vessel:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        imoNumber:
          type: string
        flag:
          type: string
        type:
          type: string
        clientId:
          $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DRY_DOCK]

    Job:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        jobNumber:
          type: string
        vesselId:
          $ref: '#/components/schemas/UUID'
        surveyorId:
          $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [PENDING, IN_PROGRESS, COMPLETED, CANCELLED]
        scheduledDate:
          $ref: '#/components/schemas/Date'

    Survey:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        jobId:
          $ref: '#/components/schemas/UUID'
        findings:
          type: array
          items:
            type: string
        complianceStatus:
          type: string
        reportUrl:
          type: string

    Certificate:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        jobId:
          $ref: '#/components/schemas/UUID'
        certificateNumber:
          type: string
        issueDate:
          $ref: '#/components/schemas/Date'
        expiryDate:
          $ref: '#/components/schemas/Date'
        status:
          type: string
          enum: [DRAFT, ISSUED, REVOKED]

    Payment:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        jobId:
          $ref: '#/components/schemas/UUID'
        amount:
          type: number
        currency:
          type: string
          default: "USD"
        status:
          type: string
          enum: [PENDING, PAID, OVERDUE]
        invoiceUrl:
          type: string

  responses:
    Unauthorized:
      description: Unauthorized Access
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
            example:
              success: false
              message: "Unauthorized - Token missing or invalid"

    Forbidden:
      description: Forbidden - Insufficient Permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
            example:
              success: false
              message: "Forbidden - You do not have the required role"

    NotFound:
      description: Resource Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
            example:
              success: false
              message: "Resource not found"

security:
  - bearerAuth: []
