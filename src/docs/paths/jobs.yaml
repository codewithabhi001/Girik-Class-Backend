/api/v1/jobs:
  get:
    tags: [Jobs]
    summary: List jobs
    description: List all jobs. CLIENT sees only their vessels' jobs; SURVEYOR sees assigned jobs.
    operationId: getJobs
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: page
        in: query
        schema:
          type: integer
          default: 1
      - name: limit
        in: query
        schema:
          type: integer
          default: 20
      - name: status
        in: query
        schema:
          type: string
          enum: [CREATED, GM_APPROVED, TM_PRE_APPROVED, ASSIGNED, SURVEY_DONE, TO_APPROVED, TM_FINAL, PAYMENT_DONE, CERTIFIED, REJECTED]
    responses:
      "200":
        description: List of jobs
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
                  items:
                    $ref: '#/components/schemas/JobResponse'
            example:
              success: true
              data:
                - id: "01933c5e-7f2a-7a00-8000-1a2b3c4d5e6f"
                  job_status: "CREATED"
                  reason: "Annual survey due"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

  post:
    tags: [Jobs]
    summary: Create job
    description: Create a new job request. CLIENT, ADMIN, GM only.
    operationId: createJob
    x-roles: [CLIENT, ADMIN, GM]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/JobCreateRequest'
          example:
            vessel_id: "01933c5e-7f2a-7a00-8000-1a2b3c4d5e6f"
            certificate_type_id: "01933c5e-7f2b-7a00-8000-1a2b3c4d5e6f"
            reason: "Annual survey due"
            target_port: "Singapore"
            target_date: "2026-03-15"
    responses:
      "201":
        description: Job created
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'
            example:
              success: true
              data:
                id: "01933c5e-7f2a-7a00-8000-1a2b3c4d5e6f"
                job_status: "CREATED"
      "400":
        description: Validation error
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/jobs/{id}:
  get:
    tags: [Jobs]
    summary: Get job by ID
    description: Get job details by ID.
    operationId: getJobById
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Job details
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'
      "404":
        description: Job not found
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/jobs/{id}/status:
  put:
    tags: [Jobs]
    summary: Update job status
    description: Update job status. ADMIN, GM, TM, TO only.
    operationId: updateJobStatus
    x-roles: [ADMIN, GM, TM, TO]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/JobStatusUpdateRequest'
          example:
            status: "GM_APPROVED"
            remarks: "Approved for survey"
    responses:
      "200":
        description: Status updated
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/jobs/{id}/assign:
  put:
    tags: [Jobs]
    summary: Assign surveyor
    description: Assign a surveyor to the job. ADMIN, GM only.
    operationId: assignSurveyor
    x-roles: [ADMIN, GM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AssignSurveyorRequest'
          example:
            surveyorId: "01933c5e-7f2c-7a00-8000-1a2b3c4d5e6f"
    responses:
      "200":
        description: Surveyor assigned
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/jobs/{id}/reassign:
  put:
    tags: [Jobs]
    summary: Reassign surveyor
    description: Reassign job to another surveyor with reason. GM, TM only.
    operationId: reassignSurveyor
    x-roles: [GM, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ReassignJobRequest'
          example:
            surveyorId: "01933c5e-7f2c-7a00-8000-1a2b3c4d5e6f"
            reason: "Surveyor unavailable"
    responses:
      "200":
        description: Job reassigned
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'
      "400":
        description: Validation error
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/jobs/{id}/escalate:
  put:
    tags: [Jobs]
    summary: Escalate job
    description: Escalate job to GM or ADMIN. GM, TM, TO only.
    operationId: escalateJob
    x-roles: [GM, TM, TO]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EscalateJobRequest'
          example:
            reason: "Requires senior approval"
            target_role: "GM"
    responses:
      "200":
        description: Job escalated
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/jobs/{id}/cancel:
  put:
    tags: [Jobs]
    summary: Cancel job
    description: Cancel a job. CLIENT, GM, TM, ADMIN.
    operationId: cancelJob
    x-roles: [CLIENT, GM, TM, ADMIN]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/JobCancelRequest'
          example:
            reason: "Client requested cancellation"
    responses:
      "200":
        description: Job cancelled
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/jobs/{id}/hold:
  put:
    tags: [Jobs]
    summary: Hold job
    description: Put job on hold. GM, TM, ADMIN only.
    operationId: holdJob
    x-roles: [GM, TM, ADMIN]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              reason:
                type: string
          example:
            reason: "Awaiting client confirmation"
    responses:
      "200":
        description: Job held
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'

/api/v1/jobs/{id}/resume:
  put:
    tags: [Jobs]
    summary: Resume job
    description: Resume a held job. GM, TM, ADMIN only.
    operationId: resumeJob
    x-roles: [GM, TM, ADMIN]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              reason:
                type: string
          example:
            reason: "Client confirmed. Resuming job."
    responses:
      "200":
        description: Job resumed
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'

/api/v1/jobs/{id}/clone:
  post:
    tags: [Jobs]
    summary: Clone job
    description: Create a copy of the job. GM, TM, ADMIN only.
    operationId: cloneJob
    x-roles: [GM, TM, ADMIN]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "201":
        description: Job cloned
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'

/api/v1/jobs/{id}/priority:
  put:
    tags: [Jobs]
    summary: Update job priority
    description: Update job priority. ADMIN, GM, TM only.
    operationId: updateJobPriority
    x-roles: [ADMIN, GM, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      content:
        application/json:
          schema:
            type: object
            required: [priority]
            properties:
              priority:
                type: string
                enum: [LOW, NORMAL, HIGH, URGENT]
          example:
            priority: "HIGH"
    responses:
      "200":
        description: Priority updated
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/JobResponse'

/api/v1/jobs/{id}/history:
  get:
    tags: [Jobs]
    summary: Get job history
    description: Get status history and audit trail. ADMIN, GM, TM, TO only.
    operationId: getJobHistory
    x-roles: [ADMIN, GM, TM, TO]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Job history
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
                  items:
                    type: object

/api/v1/jobs/{id}/notes:
  post:
    tags: [Jobs]
    summary: Add internal note
    description: Add internal note to job. ADMIN, GM, TM, TO only.
    operationId: addInternalNote
    x-roles: [ADMIN, GM, TM, TO]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AddNoteRequest'
          example:
            note_text: "Client confirmed availability"
    responses:
      "201":
        description: Note added
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object

/api/v1/jobs/{id}/messages/external:
  get:
    tags: [Jobs]
    summary: Get external messages
    description: Get client-facing messages for the job.
    operationId: getJobMessagesExternal
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: External messages
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
                  items:
                    type: object

/api/v1/jobs/{id}/messages/internal:
  get:
    tags: [Jobs]
    summary: Get internal messages
    description: Get internal staff messages. ADMIN, GM, TM, TO only.
    operationId: getJobMessagesInternal
    x-roles: [ADMIN, GM, TM, TO]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Internal messages
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array

/api/v1/jobs/{id}/messages:
  post:
    tags: [Jobs]
    summary: Send message
    description: Send message on job. Supports file attachment via multipart/form-data.
    operationId: sendJobMessage
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/MessageCreateRequest'
          example:
            content: "Survey completed. Awaiting approval."
        multipart/form-data:
          schema:
            type: object
            properties:
              content:
                type: string
              attachment:
                type: string
                format: binary
    responses:
      "201":
        description: Message sent
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
