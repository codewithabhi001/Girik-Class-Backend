/api/v1/support:
  post:
    tags: [Support]
    summary: Create support ticket
    operationId: createSupportTicket
    x-roles: [ADMIN, GM, TM, TO, TA, SURVEYOR, CLIENT, FLAG_ADMIN]
    requestBody:
      content:
        application/json:
          schema:
            type: object
            required: [subject]
            properties:
              subject: { type: string }
              description: { type: string }
              message: { type: string }
              priority: { type: string, enum: [LOW, MEDIUM, HIGH, URGENT] }
          example:
            subject: "Unable to submit survey"
            description: "Getting 500 error when submitting survey for job XYZ"
            priority: "HIGH"
    responses:
      "201": { description: Ticket created }

  get:
    tags: [Support]
    summary: Get support tickets
    operationId: getSupportTickets
    x-roles: [ADMIN, GM, TM, TO, TA, SURVEYOR, CLIENT, FLAG_ADMIN]
    responses:
      "200": { description: List of tickets }

/api/v1/support/{id}:
  get:
    tags: [Support]
    summary: Get ticket by ID
    operationId: getSupportTicketById
    x-roles: [ADMIN, GM, TM, TO, TA, SURVEYOR, CLIENT, FLAG_ADMIN]
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      "200": { description: Ticket details }

  put:
    tags: [Support]
    summary: Update ticket status (or use /support/{id}/status)
    operationId: updateSupportTicketStatus
    x-roles: [ADMIN, GM]
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      content:
        application/json:
          schema:
            type: object
            required: [status]
            properties:
              status: { type: string, enum: [OPEN, IN_PROGRESS, RESOLVED, CLOSED] }
          example:
            status: "RESOLVED"
    responses:
      "200": { description: Status updated }
      "403": { description: Forbidden }

/api/v1/support/{id}/status:
  put:
    tags: [Support]
    summary: Update ticket status
    operationId: updateSupportTicketStatusPath
    x-roles: [ADMIN, GM]
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      content:
        application/json:
          schema:
            type: object
            required: [status]
            properties:
              status: { type: string, enum: [OPEN, IN_PROGRESS, RESOLVED, CLOSED] }
              internal_note: { type: string }
          example:
            status: "RESOLVED"
            internal_note: "Issue resolved and closed."
    responses:
      "200": { description: Status updated }
      "403": { description: Forbidden }
