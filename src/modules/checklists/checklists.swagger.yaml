paths:
  # ==================== JOB CHECKLISTS ====================
  /jobs/{jobId}/checklist:
    get:
      summary: Get Job Checklist
      description: Retrieve the inspection checklist associated with a specific job.
      tags: [Checklists]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Checklist details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

    put:
      summary: Submit Checklist
      description: Submit completed checklist answers for a job.
      tags: [Checklists]
      security:
        - bearerAuth: []
      x-roles: [SURVEYOR]
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items]
              properties:
                items:
                  type: array
                  items:
                    type: object
                    required: [question_code, question_text, answer]
                    properties:
                      question_code:
                        type: string
                        example: "LSE001"
                      question_text:
                        type: string
                        example: "Are life jackets available for all persons on board?"
                      answer:
                        type: string
                        enum: [YES, NO, NA]
                        example: "YES"
                      remarks:
                        type: string
                        example: "20 life jackets found in good condition"
      responses:
        '200':
          description: Checklist submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ==================== CHECKLIST TEMPLATES ====================
  /checklist-templates:
    get:
      summary: List All Checklist Templates
      description: Get all checklist templates with optional filters
      tags: [Checklists]
      security:
        - bearerAuth: []
      x-roles: [ADMIN, GM, TM, SURVEYOR]
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [ACTIVE, INACTIVE, DRAFT]
          description: Filter by template status
        - in: query
          name: certificate_type_id
          schema:
            type: string
            format: uuid
          description: Filter by certificate type
      responses:
        '200':
          description: List of checklist templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ChecklistTemplate'

    post:
      summary: Create Checklist Template
      description: Create a new checklist template (ADMIN only)
      tags: [Checklists]
      security:
        - bearerAuth: []
      x-roles: [ADMIN]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChecklistTemplateInput'
      responses:
        '201':
          description: Template created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Checklist template created successfully"
                  data:
                    $ref: '#/components/schemas/ChecklistTemplate'

  /checklist-templates/{id}:
    get:
      summary: Get Checklist Template by ID
      description: Retrieve a specific checklist template
      tags: [Checklists]
      security:
        - bearerAuth: []
      x-roles: [ADMIN, GM, TM, SURVEYOR]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Template details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/ChecklistTemplate'
        '404':
          description: Template not found

    put:
      summary: Update Checklist Template
      description: Update an existing checklist template (ADMIN only)
      tags: [Checklists]
      security:
        - bearerAuth: []
      x-roles: [ADMIN]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChecklistTemplateInput'
      responses:
        '200':
          description: Template updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Checklist template updated successfully"
                  data:
                    $ref: '#/components/schemas/ChecklistTemplate'

    delete:
      summary: Delete Checklist Template
      description: Soft delete a checklist template by setting status to INACTIVE (ADMIN only)
      tags: [Checklists]
      security:
        - bearerAuth: []
      x-roles: [ADMIN]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Template deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Checklist template deleted successfully"

  /checklist-templates/job/{jobId}:
    get:
      summary: Get Checklist Template for Job
      description: |
        **CRITICAL ENDPOINT FOR SURVEYORS**
        
        Automatically fetches the appropriate checklist template for a specific job 
        based on the job's certificate type. This is what surveyors use to know 
        which questions to answer.
      tags: [Checklists]
      security:
        - bearerAuth: []
      x-roles: [SURVEYOR, ADMIN, GM, TM, TO]
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
            format: uuid
          description: The job ID to get the template for
      responses:
        '200':
          description: Template for the job
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Use this template to fill out the checklist for this job"
                  data:
                    $ref: '#/components/schemas/ChecklistTemplate'
        '404':
          description: No active template found for this job's certificate type
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "No active checklist template found for certificate type: Load Line Certificate"

  /checklist-templates/{id}/activate:
    put:
      summary: Activate Checklist Template
      description: Set template status to ACTIVE (ADMIN only)
      tags: [Checklists]
      security:
        - bearerAuth: []
      x-roles: [ADMIN]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Template activated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Checklist template activated successfully"
                  data:
                    $ref: '#/components/schemas/ChecklistTemplate'

  /checklist-templates/{id}/clone:
    post:
      summary: Clone Checklist Template
      description: Create a copy of an existing template (ADMIN only)
      tags: [Checklists]
      security:
        - bearerAuth: []
      x-roles: [ADMIN]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Template cloned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Checklist template cloned successfully"
                  data:
                    $ref: '#/components/schemas/ChecklistTemplate'

components:
  schemas:
    ChecklistTemplate:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "019c4b0d-df72-75bb-ba86-7455c75a4720"
        name:
          type: string
          example: "Safety Equipment Inspection Checklist"
        code:
          type: string
          example: "SAFETY_EQUIP_001"
        description:
          type: string
          example: "Comprehensive checklist for inspecting vessel safety equipment"
        certificate_type_id:
          type: string
          format: uuid
          nullable: true
          example: "019c4b07-983f-707e-b168-2fb307169bd2"
        sections:
          type: array
          items:
            type: object
            properties:
              title:
                type: string
                example: "Life-Saving Appliances"
              items:
                type: array
                items:
                  type: object
                  properties:
                    code:
                      type: string
                      example: "LSE001"
                    text:
                      type: string
                      example: "Are life jackets available for all persons on board?"
                    type:
                      type: string
                      enum: [YES_NO_NA, TEXT, NUMBER]
                      example: "YES_NO_NA"
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DRAFT]
          example: "ACTIVE"
        metadata:
          type: object
          properties:
            version:
              type: string
              example: "1.0"
            applicable_vessel_types:
              type: array
              items:
                type: string
              example: ["CARGO", "TANKER", "PASSENGER"]
            estimated_completion_time_minutes:
              type: integer
              example: 60
        CertificateType:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
              example: "Safety Equipment Certificate"
            issuing_authority:
              type: string
              enum: [CLASS, FLAG]
              example: "CLASS"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ChecklistTemplateInput:
      type: object
      required:
        - name
        - code
        - sections
      properties:
        name:
          type: string
          example: "Safety Equipment Inspection Checklist"
        code:
          type: string
          example: "SAFETY_EQUIP_001"
        description:
          type: string
          example: "Comprehensive checklist for inspecting vessel safety equipment"
        certificate_type_id:
          type: string
          format: uuid
          nullable: true
          example: "019c4b07-983f-707e-b168-2fb307169bd2"
        sections:
          type: array
          items:
            type: object
            required:
              - title
              - items
            properties:
              title:
                type: string
                example: "Life-Saving Appliances"
              items:
                type: array
                items:
                  type: object
                  required:
                    - code
                    - text
                  properties:
                    code:
                      type: string
                      example: "LSE001"
                    text:
                      type: string
                      example: "Are life jackets available for all persons on board?"
                    type:
                      type: string
                      enum: [YES_NO_NA, TEXT, NUMBER]
                      default: "YES_NO_NA"
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DRAFT]
          default: "DRAFT"
        metadata:
          type: object
          properties:
            version:
              type: string
            applicable_vessel_types:
              type: array
              items:
                type: string
            estimated_completion_time_minutes:
              type: integer
