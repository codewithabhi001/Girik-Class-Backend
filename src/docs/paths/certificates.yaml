/api/v1/certificates/verify/{number}:
  get:
    tags: [Certificates]
    summary: Verify certificate (public)
    description: Public verification of certificate by number. No auth required.
    security: []
    operationId: verifyCertificate
    x-roles: [PUBLIC]
    parameters:
      - name: number
        in: path
        required: true
        schema:
          type: string
          example: "GIR-CERT-2026-001234"
    responses:
      "200":
        description: Certificate verified
        content:
          application/json:
            schema:
              type: object
              properties:
                valid:
                  type: boolean
                certificate:
                  $ref: '#/components/schemas/CertificateResponse'
      "404":
        description: Certificate not found
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/certificates:
  get:
    tags: [Certificates]
    summary: List certificates
    description: |
      List certificates with strict RBAC and ownership filtering.
      **Access:**
      - **ADMIN / GM / TM / TO:** All certificates.
      - **SURVEYOR:** Only certificates for vessels in jobs assigned to them.
      - **CLIENT:** Only certificates for their own company vessels.
    security: [{ bearerAuth: [] }]
    operationId: getCertificates
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: page
        in: query
        schema:
          type: integer
          default: 1
      - name: limit
        in: query
        schema:
          type: integer
          default: 20
    responses:
      "200":
        description: List of certificates
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
                  items:
                    $ref: '#/components/schemas/CertificateResponse'
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

  post:
    tags: [Certificates]
    summary: Generate certificate
    description: Generate a new certificate for a completed job. ADMIN, GM, TM only.
    security: [{ bearerAuth: [] }]
    operationId: generateCertificate
    x-roles: [ADMIN, GM, TM]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GenerateCertificateRequest'
          example:
            job_id: "01933c5e-7f2a-7a00-8000-1a2b3c4d5e6f"
            validity_years: 1
    responses:
      "201":
        description: Certificate generated
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "Certificate generated successfully"
                data:
                  $ref: '#/components/schemas/CertificateResponse'
      "400":
        description: Validation error
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/certificates/types:
  get:
    tags: [Certificates]
    summary: Get certificate types
    description: List available certificate types.
    security: [{ bearerAuth: [] }]
    operationId: getCertificateTypes
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    responses:
      "200":
        description: Certificate types list
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      name:
                        type: string
  post:
    tags: [Certificates]
    summary: Create certificate type
    description: Create a new certificate type. ADMIN only.
    operationId: createCertificateType
    x-roles: [ADMIN]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name]
            properties:
              name: { type: string }
              issuing_authority: { type: string, enum: [CLASS, FLAG] }
              validity_years: { type: integer }
    responses:
      "201":
        description: Certificate type created
      "403":
        description: Forbidden

/api/v1/certificates/bulk-renew:
  post:
    tags: [Certificates]
    summary: Bulk renew certificates
    description: Renew multiple certificates in one operation. ADMIN, TM only.
    operationId: bulkRenewCertificates
    x-roles: [ADMIN, TM]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [certificate_ids]
            properties:
              certificate_ids:
                type: array
                items: { type: string, format: uuid }
              validity_years: { type: integer, default: 1 }
              reason: { type: string }
    responses:
      "200":
        description: Bulk renewal completed
      "403":
        description: Forbidden

/api/v1/certificates/expiring:
  get:
    tags: [Certificates]
    summary: Get expiring certificates
    description: Get certificates expiring within a date range. ADMIN, GM, TM, TO, CLIENT.
    operationId: getExpiringCertificates
    x-roles: [CLIENT, ADMIN, GM, TM, TO]
    parameters:
      - name: days
        in: query
        schema:
          type: integer
          default: 90
    responses:
      "200":
        description: Expiring certificates
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
                  items:
                    $ref: '#/components/schemas/CertificateResponse'

/api/v1/certificates/vessel/{vesselId}:
  get:
    tags: [Certificates]
    summary: Get certificates by vessel
    description: Get all certificates for a specific vessel. Scope restricted (SURVEYOR only assigned, CLIENT only owned).
    operationId: getCertificatesByVessel
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: vesselId
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      "200":
        description: Vessel certificates
        content:
          application/json:
            schema:
              type: object
              properties:
                success: { type: boolean, example: true }
                data:
                  type: array
                  items:
                    $ref: '#/components/schemas/CertificateResponse'

/api/v1/certificates/{id}:
  get:
    tags: [Certificates]
    summary: Get certificate by ID
    description: |
      Get certificate details by ID. Same RBAC as list: ADMIN/GM/TM/TO see all; SURVEYOR only assigned jobs' vessels; CLIENT only own company. Returns 403 if certificate exists but user has no access.
    security: [{ bearerAuth: [] }]
    operationId: getCertificateById
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Certificate details
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '#/components/schemas/CertificateResponse'
      "403":
        description: Forbidden - certificate exists but user has no access
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
      "404":
        description: Certificate not found
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/certificates/{id}/download:
  get:
    tags: [Certificates]
    summary: Download certificate PDF
    description: |
      Redirects to the certificate PDF URL for download. If the certificate has a stored PDF (pdf_file_url), returns 302 redirect to that URL so the browser can open or download the file.
      CLIENT can only download certificates for their vessels.
    operationId: downloadCertificate
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Certificate ID
    responses:
      "302":
        description: Redirect to certificate PDF URL
        headers:
          Location:
            description: URL of the certificate PDF
            schema:
              type: string
              example: "https://storage.example.com/certificates/abc-123.pdf"
      "404":
        description: Certificate not found or PDF not available
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Certificate PDF is not available for download yet."

/api/v1/certificates/{id}/suspend:
  put:
    tags: [Certificates]
    summary: Suspend certificate
    description: Suspend a certificate. ADMIN, TM only.
    operationId: suspendCertificate
    x-roles: [ADMIN, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CertActionRequest'
          example:
            reason: "Administrative suspension"
    responses:
      "200":
        description: Certificate suspended
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                data:
                  $ref: '#/components/schemas/CertificateResponse'
      "400":
        description: Validation error
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

/api/v1/certificates/{id}/revoke:
  put:
    tags: [Certificates]
    summary: Revoke certificate
    description: Revoke a certificate. ADMIN, TM only.
    operationId: revokeCertificate
    x-roles: [ADMIN, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CertActionRequest'
          example:
            reason: "Vessel sold"
    responses:
      "200":
        description: Certificate revoked
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                data:
                  $ref: '#/components/schemas/CertificateResponse'

/api/v1/certificates/{id}/restore:
  put:
    tags: [Certificates]
    summary: Restore certificate
    description: Restore a suspended certificate. ADMIN, TM only.
    operationId: restoreCertificate
    x-roles: [ADMIN, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CertActionRequest'
          example:
            reason: "Issue resolved"
    responses:
      "200":
        description: Certificate restored
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                data:
                  $ref: '#/components/schemas/CertificateResponse'

/api/v1/certificates/{id}/renew:
  put:
    tags: [Certificates]
    summary: Renew certificate
    description: Renew an expiring certificate. ADMIN, TM only.
    operationId: renewCertificate
    x-roles: [ADMIN, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/RenewCertRequest'
          example:
            validity_years: 1
            reason: "Standard renewal"
    responses:
      "200":
        description: Certificate renewed
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                data:
                  $ref: '#/components/schemas/CertificateResponse'

/api/v1/certificates/{id}/reissue:
  post:
    tags: [Certificates]
    summary: Reissue certificate
    description: Reissue a certificate (e.g. after loss). ADMIN, TM only.
    operationId: reissueCertificate
    x-roles: [ADMIN, TM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CertActionRequest'
          example:
            reason: "Original lost"
    responses:
      "200":
        description: Certificate reissued
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                data:
                  $ref: '#/components/schemas/CertificateResponse'

/api/v1/certificates/{id}/transfer:
  post:
    tags: [Certificates]
    summary: Transfer certificate
    description: Transfer certificate ownership/association. ADMIN, GM only.
    operationId: transferCertificate
    x-roles: [ADMIN, GM]
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CertActionRequest'
    responses:
      "200":
        description: Certificate transferred
      "403":
        description: Forbidden

/api/v1/certificates/{id}/extend:
  post:
    tags: [Certificates]
    summary: Extend certificate
    description: Extend certificate validity. ADMIN, GM only.
    operationId: extendCertificate
    x-roles: [ADMIN, GM]
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CertActionRequest'
    responses:
      "200":
        description: Certificate extended
      "403":
        description: Forbidden

/api/v1/certificates/{id}/downgrade:
  put:
    tags: [Certificates]
    summary: Downgrade certificate
    description: Downgrade certificate classification/type. ADMIN, GM only.
    operationId: downgradeCertificate
    x-roles: [ADMIN, GM]
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CertActionRequest'
    responses:
      "200":
        description: Certificate downgraded
      "403":
        description: Forbidden

/api/v1/certificates/{id}/preview:
  get:
    tags: [Certificates]
    summary: Preview certificate
    description: Get certificate preview/PDF. ADMIN, GM, TM, TO, SURVEYOR, CLIENT.
    operationId: previewCertificate
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Certificate preview
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object

/api/v1/certificates/{id}/sign:
  post:
    tags: [Certificates]
    summary: Sign certificate
    description: Digitally sign a certificate. ADMIN, GM only.
    operationId: signCertificate
    x-roles: [ADMIN, GM]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Certificate signed
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string

/api/v1/certificates/{id}/signature:
  get:
    tags: [Certificates]
    summary: Get certificate signature
    description: Get signature details for a certificate.
    operationId: getCertificateSignature
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Signature details
        content:
          application/json:
            schema:
              type: object

/api/v1/certificates/{id}/history:
  get:
    tags: [Certificates]
    summary: Get certificate history
    description: Get certificate change history.
    operationId: getCertificateHistory
    x-roles: [CLIENT, ADMIN, GM, TM, TO, SURVEYOR]
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Certificate history
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
