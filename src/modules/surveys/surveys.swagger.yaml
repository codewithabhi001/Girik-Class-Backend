paths:
  /surveys/start:
    post:
      summary: Start Survey
      description: Record the start of a survey (check-in) with location.
      tags: [Surveys]
      security:
        - bearerAuth: []
      x-roles: [SURVEYOR]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [jobId, location]
              properties:
                jobId:
                  type: string
                  format: uuid
                  description: ID of the job being surveyed
                location:
                  type: object
                  description: GPS coordinates
                  properties:
                    lat:
                      type: number
                    lng:
                      type: number
      responses:
        '201':
          description: Survey started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /surveys:
    get:
      summary: List Survey Reports
      description: Retrieve a paginated list of survey reports.
      tags: [Surveys]
      security:
        - bearerAuth: []
      x-roles: [ADMIN, GM, TM, TO]
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: List of survey reports
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginationResponse'

    post:
      summary: Submit Survey Report
      description: Upload a survey report with photo/findings.
      tags: [Surveys]
      security:
        - bearerAuth: []
      x-roles: [SURVEYOR]
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              required: [jobId, findings]
              properties:
                jobId:
                  type: string
                  format: uuid
                findings:
                  type: string
                  description: JSON string or text summary of findings
                photo:
                  type: string
                  format: binary
      responses:
        '201':
          description: Report submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /surveys/{id}/finalize:
    put:
      summary: Finalize Survey
      description: Mark the survey as complete and generate final output.
      tags: [Surveys]
      security:
        - bearerAuth: []
      x-roles: [SURVEYOR]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Survey finalized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /surveys/{id}/location:
    post:
      summary: Stream Location
      description: Update real-time location of the surveyor during a survey.
      tags: [Surveys]
      security:
        - bearerAuth: []
      x-roles: [SURVEYOR]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [lat, lng]
              properties:
                lat:
                  type: number
                lng:
                  type: number
      responses:
        '200':
          description: Location updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /surveys/{id}/proof:
    post:
      summary: Upload Evidence
      description: Upload photos or documents as evidence for findings.
      tags: [Surveys]
      security:
        - bearerAuth: []
      x-roles: [SURVEYOR]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              required: [proof]
              properties:
                proof:
                  type: string
                  format: binary
                description:
                  type: string
      responses:
        '201':
          description: Evidence uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /surveys/{id}/timeline:
    get:
      summary: Execution Timeline
      description: Get the timeline of events for a survey.
      tags: [Surveys]
      security:
        - bearerAuth: []
      x-roles: [ADMIN, GM, TM]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Timeline
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /surveys/{id}/violation:
    post:
      summary: Flag Violation
      description: Record a violation found during survey review.
      tags: [Surveys]
      security:
        - bearerAuth: []
      x-roles: [ADMIN, TM]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [description, severity]
              properties:
                description:
                  type: string
                severity:
                  type: string
                  enum: [LOW, MEDIUM, HIGH, CRITICAL]
      responses:
        '201':
          description: Violation flagged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
